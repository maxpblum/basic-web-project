import * as Tone from 'tone';

const VELOCITY = 0.5039370078740157 as const;

const EIGHTH_LENGTH_S = 0.1515 as const;

const EIGHTH_LENGTH_TICKS = 60 as const;
const TICK_LENGTH_S = EIGHTH_LENGTH_S / EIGHTH_LENGTH_TICKS;

interface Pos {
  // 1-based
  measure: number;
  // 1-based
  beat: number;
  // 0-based
  partial: number;
}

function posOfStr(posStr: `${number}.${number}.${number}`): Pos {
  const [measure, beat, partial] = posStr.split('.');
  return {
    measure: Number(measure),
    beat: Number(beat),
    partial: Number(`0.${partial}`),
  };
}

interface BasicNote {
  durationTicks: number;
  midi: number;
  name: string;
  pos: `${number}.${number}.${number}`;
}

interface ConvertedNote {
  name: string;
  duration: number;
  time: number;
  velocity: number;
}

function expand(n: BasicNote): ConvertedNote {
  const pos = posOfStr(n.pos);
  const ticks =
    180 * (pos.measure - 1) + 60 * (pos.beat - 1) + 60 * pos.partial;
  return {
    name: n.name,
    duration: n.durationTicks * TICK_LENGTH_S,
    time: ticks * TICK_LENGTH_S,
    velocity: VELOCITY,
  };
}

export function arpeggiate(
  pitches: string[],
  totalDurationTicks: number,
  noteDurationTicks: number,
  startPos: `${number}.${number}.${number}`
): ConvertedNote[] {
  if (pitches.length === 0) {
    throw new Error('Pitches array cannot be empty');
  }
  if (totalDurationTicks % noteDurationTicks !== 0) {
    throw new Error('Note duration must divide evenly into total duration');
  }

  const numNotes = totalDurationTicks / noteDurationTicks;
  const startPosObj = posOfStr(startPos);
  const startTicks =
    180 * (startPosObj.measure - 1) +
    60 * (startPosObj.beat - 1) +
    60 * startPosObj.partial;

  const notes: ConvertedNote[] = [];

  for (let i = 0; i < numNotes; i++) {
    const pitch = pitches[i % pitches.length]!;
    const currentTicks = startTicks + i * noteDurationTicks;

    notes.push({
      name: pitch,
      duration: noteDurationTicks * TICK_LENGTH_S,
      time: currentTicks * TICK_LENGTH_S,
      velocity: VELOCITY,
    });
  }

  return notes;
}

const rh = [
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '1.1.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '1.2.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '1.3.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '2.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '2.2.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '2.3.000' }),
  expand({ durationTicks: 60, midi: 61, name: 'C#4', pos: '3.1.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '3.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '3.3.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '4.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '4.2.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '4.3.000' }),
  expand({ durationTicks: 120, midi: 65, name: 'F4', pos: '5.1.000' }),
  expand({ durationTicks: 120, midi: 69, name: 'A4', pos: '5.3.000' }),
  expand({ durationTicks: 120, midi: 74, name: 'D5', pos: '6.2.000' }),
  expand({ durationTicks: 120, midi: 67, name: 'G4', pos: '7.1.000' }),
  expand({ durationTicks: 120, midi: 73, name: 'C#5', pos: '7.3.000' }),
  expand({ durationTicks: 120, midi: 76, name: 'E5', pos: '8.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '9.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '9.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '9.3.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '10.1.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '10.2.000' }),
  expand({ durationTicks: 60, midi: 82, name: 'Bb5', pos: '10.3.000' }),
  expand({ durationTicks: 60, midi: 73, name: 'C#5', pos: '11.1.000' }),
  expand({ durationTicks: 60, midi: 82, name: 'Bb5', pos: '11.2.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '11.3.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '12.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '12.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '12.3.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '13.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '13.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '13.3.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '14.1.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '14.2.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '14.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '15.1.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '15.2.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '15.3.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '16.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '16.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '16.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '17.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '17.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '17.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '18.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '18.2.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '18.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '19.1.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '19.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '19.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '20.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '20.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '20.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '21.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '21.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '21.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '22.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '22.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '22.3.000' }),
  expand({ durationTicks: 120, midi: 67, name: 'G4', pos: '23.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '25.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '25.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '25.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '26.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '26.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '26.3.000' }),
  expand({ durationTicks: 120, midi: 65, name: 'F4', pos: '27.1.000' }),
  expand({ durationTicks: 240, midi: 70, name: 'Bb4', pos: '28.2.000' }),
  expand({ durationTicks: 120, midi: 69, name: 'A4', pos: '29.3.000' }),
  expand({ durationTicks: 120, midi: 67, name: 'G4', pos: '30.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '31.1.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '31.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '31.3.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '32.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '32.2.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '32.3.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '33.1.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '33.2.000' }),
  expand({ durationTicks: 30, midi: 67, name: 'G4', pos: '33.3.000' }),
  expand({ durationTicks: 30, midi: 69, name: 'A4', pos: '33.3.500' }),
  expand({ durationTicks: 120, midi: 67, name: 'G4', pos: '34.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '34.3.000' }),
  expand({ durationTicks: 120, midi: 65, name: 'F4', pos: '35.1.000' }),
  expand({ durationTicks: 120, midi: 72, name: 'C5', pos: '35.3.000' }),
  expand({ durationTicks: 120, midi: 72, name: 'C5', pos: '36.2.000' }),
  ...arpeggiate(['C5', 'D5'], 1080, 30, '37.1.000'),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '43.1.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '43.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '43.3.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '44.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '44.2.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '44.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '45.1.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '45.2.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '45.3.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '46.1.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '46.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '46.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '47.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '47.2.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '47.3.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '48.1.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '48.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '48.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '49.1.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '49.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '49.3.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '50.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '50.2.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '50.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '51.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '51.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '51.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '52.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '52.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '52.3.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '53.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '53.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '53.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '54.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '54.2.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '54.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '55.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '55.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '55.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '56.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '56.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '56.3.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '57.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '57.2.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '57.3.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '58.1.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '58.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '58.3.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '59.1.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '59.2.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '59.3.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '60.1.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '60.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '60.3.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '61.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '61.2.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '61.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '62.1.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '62.2.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '62.3.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '63.1.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '63.2.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '63.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '64.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '64.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '64.3.000' }),
  expand({ durationTicks: 60, midi: 66, name: 'F#4', pos: '65.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '65.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '65.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '66.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '66.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '66.3.000' }),
  expand({ durationTicks: 60, midi: 68, name: 'G#4', pos: '67.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '67.2.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '67.3.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '68.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '68.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '68.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '69.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '69.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '69.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '70.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '70.2.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '70.3.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '71.1.000' }),
  expand({ durationTicks: 60, midi: 80, name: 'G#5', pos: '71.2.000' }),
  expand({ durationTicks: 60, midi: 78, name: 'F#5', pos: '71.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '72.1.000' }),
  expand({ durationTicks: 180, midi: 81, name: 'A5', pos: '72.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '73.2.000' }),
  expand({ durationTicks: 30, midi: 71, name: 'B4', pos: '73.3.000' }),
  expand({ durationTicks: 30, midi: 72, name: 'C5', pos: '73.3.500' }),
  expand({ durationTicks: 120, midi: 71, name: 'B4', pos: '74.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '74.3.000' }),
  expand({ durationTicks: 180, midi: 69, name: 'A4', pos: '75.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '76.1.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '76.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '76.3.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '77.1.000' }),
  expand({ durationTicks: 120, midi: 66, name: 'F#4', pos: '77.3.000' }),
  expand({ durationTicks: 120, midi: 69, name: 'A4', pos: '78.2.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '79.1.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '79.2.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '79.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '80.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '80.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '80.3.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '81.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '81.2.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '81.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '82.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '82.2.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '82.3.000' }),
  expand({ durationTicks: 120, midi: 69, name: 'A4', pos: '83.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '83.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '84.1.000' }),
  expand({ durationTicks: 120, midi: 77, name: 'F5', pos: '84.2.000' }),
  expand({ durationTicks: 120, midi: 67, name: 'G4', pos: '85.1.000' }),
  expand({ durationTicks: 120, midi: 76, name: 'E5', pos: '85.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '87.1.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '87.2.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '87.3.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '88.1.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '88.2.000' }),
  expand({ durationTicks: 60, midi: 82, name: 'Bb5', pos: '88.3.000' }),
  expand({ durationTicks: 60, midi: 73, name: 'C#5', pos: '89.1.000' }),
  expand({ durationTicks: 60, midi: 82, name: 'Bb5', pos: '89.2.000' }),
  expand({ durationTicks: 60, midi: 81, name: 'A5', pos: '89.3.000' }),
  expand({ durationTicks: 60, midi: 79, name: 'G5', pos: '90.1.000' }),
  expand({ durationTicks: 60, midi: 77, name: 'F5', pos: '90.2.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '90.3.000' }),
  expand({ durationTicks: 120, midi: 77, name: 'F5', pos: '91.1.000' }),
  expand({ durationTicks: 120, midi: 74, name: 'D5', pos: '91.3.000' }),
  expand({ durationTicks: 180, midi: 67, name: 'G4', pos: '92.2.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '93.2.000' }),
  expand({ durationTicks: 60, midi: 73, name: 'C#5', pos: '93.3.000' }),
  expand({ durationTicks: 60, midi: 76, name: 'E5', pos: '94.1.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '94.2.000' }),
  expand({ durationTicks: 60, midi: 73, name: 'C#5', pos: '94.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '95.1.000' }),
  expand({ durationTicks: 60, midi: 71, name: 'B4', pos: '95.2.000' }),
  expand({ durationTicks: 180, midi: 73, name: 'C#5', pos: '95.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '96.3.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '97.1.000' }),
  expand({ durationTicks: 60, midi: 72, name: 'C5', pos: '97.2.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '97.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '98.1.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '98.2.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '98.3.000' }),
  expand({ durationTicks: 60, midi: 70, name: 'Bb4', pos: '99.1.000' }),
  expand({ durationTicks: 60, midi: 61, name: 'C#4', pos: '99.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '99.3.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '100.1.000' }),
  expand({ durationTicks: 60, midi: 65, name: 'F4', pos: '100.2.000' }),
  expand({ durationTicks: 60, midi: 67, name: 'G4', pos: '100.3.000' }),
  expand({ durationTicks: 60, midi: 69, name: 'A4', pos: '101.1.000' }),
  expand({ durationTicks: 60, midi: 74, name: 'D5', pos: '101.2.000' }),
  expand({ durationTicks: 120, midi: 65, name: 'F4', pos: '101.3.000' }),
  expand({ durationTicks: 60, midi: 64, name: 'E4', pos: '102.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '102.3.000' }),
  expand({ durationTicks: 720, midi: 62, name: 'D4', pos: '103.1.000' }),
];

const lh = [
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '5.1.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '5.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '5.3.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '6.1.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '6.2.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '6.3.000' }),
  expand({ durationTicks: 60, midi: 49, name: 'C#3', pos: '7.1.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '7.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '7.3.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '8.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '8.2.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '8.3.000' }),
  expand({ durationTicks: 120, midi: 53, name: 'F3', pos: '9.1.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '9.3.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '10.2.000' }),
  expand({ durationTicks: 120, midi: 52, name: 'E3', pos: '11.1.000' }),
  expand({ durationTicks: 120, midi: 55, name: 'G3', pos: '11.3.000' }),
  expand({ durationTicks: 120, midi: 61, name: 'C#4', pos: '12.2.000' }),
  expand({ durationTicks: 120, midi: 50, name: 'D3', pos: '13.1.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '13.3.000' }),
  expand({ durationTicks: 120, midi: 53, name: 'F3', pos: '14.2.000' }),
  expand({ durationTicks: 120, midi: 55, name: 'G3', pos: '15.1.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '15.3.000' }),
  expand({ durationTicks: 120, midi: 58, name: 'Bb3', pos: '16.2.000' }),
  expand({ durationTicks: 120, midi: 48, name: 'C3', pos: '17.1.000' }),
  expand({ durationTicks: 120, midi: 60, name: 'C4', pos: '17.3.000' }),
  expand({ durationTicks: 120, midi: 52, name: 'E3', pos: '18.2.000' }),
  expand({ durationTicks: 120, midi: 53, name: 'F3', pos: '19.1.000' }),
  expand({ durationTicks: 120, midi: 55, name: 'G3', pos: '19.3.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '20.2.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '21.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '21.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '21.3.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '22.1.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '22.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '22.3.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '23.1.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '23.2.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '23.3.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '24.1.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '24.2.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '24.3.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '25.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '25.2.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '25.3.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '26.1.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '26.2.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '26.3.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '27.1.000' }),
  expand({ durationTicks: 60, midi: 60, name: 'C4', pos: '27.2.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '27.3.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '28.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '28.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '28.3.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '29.1.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '29.2.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '29.3.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '30.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '30.2.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '30.3.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '31.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '31.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '31.3.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '32.1.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '32.2.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '32.3.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '33.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '33.2.000' }),
  expand({ durationTicks: 120, midi: 48, name: 'C3', pos: '33.3.000' }),
  expand({ durationTicks: 120, midi: 36, name: 'C2', pos: '34.2.000' }),
  expand({ durationTicks: 60, midi: 41, name: 'F2', pos: '35.1.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '35.2.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '35.3.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '36.1.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '36.2.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '36.3.000' }),
  expand({ durationTicks: 60, midi: 40, name: 'E2', pos: '37.1.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '37.2.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '37.3.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '38.1.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '38.2.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '38.3.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '39.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '39.2.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '39.3.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '40.1.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '40.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '40.3.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '41.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '41.2.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '41.3.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '42.1.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '42.2.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '42.3.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '43.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '43.2.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '43.3.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '44.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '44.2.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '44.3.000' }),
  expand({ durationTicks: 120, midi: 42, name: 'F#2', pos: '45.1.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '47.1.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '47.2.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '47.3.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '48.1.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '48.2.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '48.3.000' }),
  expand({ durationTicks: 120, midi: 40, name: 'E2', pos: '49.1.000' }),
  expand({ durationTicks: 120, midi: 41, name: 'F2', pos: '51.1.000' }),
  expand({ durationTicks: 120, midi: 53, name: 'F3', pos: '51.3.000' }),
  expand({ durationTicks: 120, midi: 50, name: 'D3', pos: '52.2.000' }),
  expand({ durationTicks: 120, midi: 47, name: 'B2', pos: '53.1.000' }),
  expand({ durationTicks: 120, midi: 44, name: 'G#2', pos: '53.3.000' }),
  expand({ durationTicks: 120, midi: 40, name: 'E2', pos: '54.2.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '55.1.000' }),
  expand({ durationTicks: 60, midi: 44, name: 'G#2', pos: '55.2.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '55.3.000' }),
  expand({ durationTicks: 60, midi: 47, name: 'B2', pos: '56.1.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '56.2.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '56.3.000' }),
  ...arpeggiate(['E3', 'F3'], 1800, 30, '57.1.000'),
  expand({ durationTicks: 120, midi: 52, name: 'E3', pos: '67.1.000' }),
  expand({ durationTicks: 120, midi: 64, name: 'E4', pos: '67.3.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '68.2.000' }),
  expand({ durationTicks: 120, midi: 60, name: 'C4', pos: '69.1.000' }),
  expand({ durationTicks: 120, midi: 59, name: 'B3', pos: '69.3.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '70.2.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '71.1.000' }),
  expand({ durationTicks: 120, midi: 64, name: 'E4', pos: '71.3.000' }),
  expand({ durationTicks: 120, midi: 65, name: 'F4', pos: '72.2.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '73.1.000' }),
  expand({ durationTicks: 120, midi: 64, name: 'E4', pos: '73.3.000' }),
  expand({ durationTicks: 120, midi: 52, name: 'E3', pos: '74.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '75.1.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '75.2.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '75.3.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '76.1.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '76.2.000' }),
  expand({ durationTicks: 60, midi: 51, name: 'D#3', pos: '76.3.000' }),
  expand({ durationTicks: 60, midi: 42, name: 'F#2', pos: '77.1.000' }),
  expand({ durationTicks: 60, midi: 51, name: 'D#3', pos: '77.2.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '77.3.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '78.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '78.2.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '78.3.000' }),
  expand({ durationTicks: 180, midi: 43, name: 'G2', pos: '79.1.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '80.1.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '80.2.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '80.3.000' }),
  expand({ durationTicks: 120, midi: 36, name: 'C2', pos: '81.1.000' }),
  expand({ durationTicks: 120, midi: 43, name: 'G2', pos: '81.3.000' }),
  expand({ durationTicks: 120, midi: 48, name: 'C3', pos: '82.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '83.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '83.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '83.3.000' }),
  expand({ durationTicks: 60, midi: 59, name: 'B3', pos: '84.1.000' }),
  expand({ durationTicks: 60, midi: 61, name: 'C#4', pos: '84.2.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '84.3.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '85.1.000' }),
  expand({ durationTicks: 60, midi: 62, name: 'D4', pos: '85.2.000' }),
  expand({ durationTicks: 60, midi: 61, name: 'C#4', pos: '85.3.000' }),
  expand({ durationTicks: 60, midi: 59, name: 'B3', pos: '86.1.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '86.2.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '86.3.000' }),
  expand({ durationTicks: 120, midi: 53, name: 'F3', pos: '87.1.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '87.3.000' }),
  expand({ durationTicks: 120, midi: 62, name: 'D4', pos: '88.2.000' }),
  expand({ durationTicks: 120, midi: 52, name: 'E3', pos: '89.1.000' }),
  expand({ durationTicks: 120, midi: 55, name: 'G3', pos: '89.3.000' }),
  expand({ durationTicks: 120, midi: 61, name: 'C#4', pos: '90.2.000' }),
  expand({ durationTicks: 60, midi: 50, name: 'D3', pos: '91.1.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '91.2.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '91.3.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '92.1.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '92.2.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '92.3.000' }),
  expand({ durationTicks: 60, midi: 49, name: 'C#3', pos: '93.1.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '93.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '93.3.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '94.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '94.2.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '94.3.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '95.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '95.2.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '95.3.000' }),
  expand({ durationTicks: 120, midi: 45, name: 'A2', pos: '96.2.000' }),
  expand({ durationTicks: 180, midi: 46, name: 'Bb2', pos: '97.1.000' }),
  expand({ durationTicks: 60, midi: 48, name: 'C3', pos: '98.1.000' }),
  expand({ durationTicks: 60, midi: 46, name: 'Bb2', pos: '98.2.000' }),
  expand({ durationTicks: 60, midi: 45, name: 'A2', pos: '98.3.000' }),
  expand({ durationTicks: 60, midi: 43, name: 'G2', pos: '99.1.000' }),
  expand({ durationTicks: 60, midi: 58, name: 'Bb3', pos: '99.2.000' }),
  expand({ durationTicks: 60, midi: 57, name: 'A3', pos: '99.3.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '100.1.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '100.2.000' }),
  expand({ durationTicks: 60, midi: 52, name: 'E3', pos: '100.3.000' }),
  expand({ durationTicks: 60, midi: 53, name: 'F3', pos: '101.1.000' }),
  expand({ durationTicks: 60, midi: 55, name: 'G3', pos: '101.2.000' }),
  expand({ durationTicks: 120, midi: 57, name: 'A3', pos: '101.3.000' }),
  expand({ durationTicks: 120, midi: 45, name: 'A2', pos: '102.2.000' }),
  expand({ durationTicks: 720, midi: 38, name: 'D2', pos: '103.1.000' }),
];

class PulseSynth extends Tone.Synth {
  static override getDefaults(): Tone.SynthOptions {
    const superDefaults = Tone.Synth.getDefaults();
    return {
      ...superDefaults,
      oscillator: {
        ...superDefaults.oscillator,
        type: 'pulse',
        width: 0.5,
      },
      envelope: {
        ...superDefaults.envelope,
        attack: 0,
        decay: 0,
        sustain: 1,
        release: 0,
      },
    };
  }
}

document.getElementById('play-btn')!.addEventListener('click', async () => {
  // 1. Start Audio Context (Browsers require user interaction)
  await Tone.start();
  console.log('Audio ready');

  // 3. Create a Synth to play the notes
  // PolySynth is used because MIDI files often contain chords
  const synth = new Tone.PolySynth(PulseSynth, {
    envelope: {
      attack: 0,
      decay: 0,
      sustain: 1,
      release: 0,
    },
  }).toDestination();

  // 4. Schedule the events
  [lh, rh].forEach((track) => {
    // Tone.Part expects an array of objects with a "time" property,
    // which track already has!
    const part = new Tone.Part((time, note) => {
      // Use the parameters from the note object
      synth.triggerAttackRelease(note.name, note.duration, time, note.velocity);
    }, track).start(0);

    console.log(part);
  });

  // 5. Start the Transport to hear the music
  Tone.Transport.start();
});
